<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2016 Cisco and/or its affiliates.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at:
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!-- vi: set et smarttab sw=4 tabstop=4: -->

<snapshot>
  <required-capabilities>
      <capability>urn:opendaylight:params:xml:ns:yang:v3po:impl?module=v3po-impl&amp;revision=2014-12-10</capability>
      <capability>urn:honeycomb:params:xml:ns:yang:translate:utils?module=translate-utils&amp;revision=2016-04-06</capability>
      <capability>urn:honeycomb:params:xml:ns:yang:vpp:jvpp:cfg?module=vpp-jvpp-cfg&amp;revision=2016-04-06</capability>
      <capability>urn:honeycomb:params:xml:ns:yang:vpp:data:init?module=vpp-cfg-init&amp;revision=2016-04-07</capability>
      <capability>urn:honeycomb:params:xml:ns:yang:data:api?module=data-api&amp;revision=2016-04-11</capability>
      <capability>urn:honeycomb:params:xml:ns:yang:data:impl?module=data-impl&amp;revision=2016-04-11</capability>
      <capability>urn:opendaylight:params:xml:ns:yang:controller:md:sal:binding?module=opendaylight-md-sal-binding&amp;revision=2013-10-28</capability>
  </required-capabilities>
  <configuration>

    <data xmlns="urn:ietf:params:xml:ns:netconf:base:1.0">
      <modules xmlns="urn:opendaylight:params:xml:ns:yang:controller:config">

        <!-- TODO provide information stored in context data-tree to users as part of operational data -->
        <!-- In-memory data tree for context(special data required for YANG <-> VPP mapping) data -->
        <module>
          <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:data:impl">prefix:inmemory-data-tree</type>
          <name>inmemory-context-data-tree</name>
          <schema-service>
            <type xmlns:dom="urn:opendaylight:params:xml:ns:yang:controller:md:sal:dom">dom:schema-service</type>
            <name>yang-schema-service</name>
          </schema-service>
          <type xmlns="urn:honeycomb:params:xml:ns:yang:data:impl">oper</type>
        </module>

        <!-- DataTree adapter with persistence for context DT -->
        <module>
          <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:data:impl">prefix:persisting-data-tree-adapter</type>
          <name>inmemory-persisted-context-data-tree</name>
          <delegate>
            <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:data:api">prefix:data-tree</type>
            <name>inmemory-context-data-tree</name>
          </delegate>
          <schema-service>
            <type xmlns:dom="urn:opendaylight:params:xml:ns:yang:controller:md:sal:dom">dom:schema-service</type>
            <name>yang-schema-service</name>
          </schema-service>
          <persist-file-path>etc/opendaylight/honeycomb/context.json</persist-file-path>
        </module>

        <!-- DOM Data Broker for context data -->
        <module>
          <type xmlns:prefix="urn:opendaylight:params:xml:ns:yang:v3po:impl">prefix:honeycomb-context-dom-data-broker</type>
          <name>honeycomb-context-data-broker</name>
          <!-- With persistence -->
          <context-data-tree>
            <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:data:api">prefix:data-tree</type>
            <name>inmemory-persisted-context-data-tree</name>
          </context-data-tree>
        </module>

        <!-- BA Data Broker for context data -->
        <module>
          <type xmlns:prefix="urn:opendaylight:params:xml:ns:yang:controller:md:sal:binding:impl">prefix:binding-forwarded-data-broker</type>
          <name>honeycomb-context-binding-data-broker</name>
          <binding-forwarded-data-broker xmlns="urn:opendaylight:params:xml:ns:yang:controller:md:sal:binding:impl">
            <dom-async-broker>
              <type xmlns:dom="urn:opendaylight:params:xml:ns:yang:controller:md:sal:dom">dom:dom-async-data-broker</type>
              <name>honeycomb-context-data-broker</name>
            </dom-async-broker>
            <schema-service>
              <type xmlns:dom="urn:opendaylight:params:xml:ns:yang:controller:md:sal:dom">dom:schema-service</type>
              <name>yang-schema-service</name>
            </schema-service>
            <binding-mapping-service>
              <type xmlns:binding="urn:opendaylight:params:xml:ns:yang:controller:md:sal:binding:impl">binding:binding-dom-mapping-service</type>
              <name>runtime-mapping-singleton</name>
            </binding-mapping-service>
          </binding-forwarded-data-broker>
        </module>

        <!-- Special reader for Context data. Providing context data to outside users over NETCONF/RESTCONF -->
        <module>
          <type xmlns:prefix="urn:opendaylight:params:xml:ns:yang:v3po:impl">prefix:context-reader</type>
          <name>context-reader</name>
          <context-binding-broker>
            <type xmlns:binding="urn:opendaylight:params:xml:ns:yang:controller:md:sal:binding">binding:binding-async-data-broker</type>
            <name>honeycomb-context-binding-data-broker</name>
          </context-binding-broker>
        </module>
        <module>
          <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:translate:utils">prefix:delegating-reader-registry</type>
          <name>read-registry</name>
          <reader-factory>
            <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:translate:api">prefix:honeycomb-reader-factory</type>
            <name>context-reader</name>
          </reader-factory>
        </module>
        <!-- END: Special reader for Context -->

        <!-- Mapping context on top of BA context broker. Utilized by eg notification producers -->
        <module>
          <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:translate:utils">prefix:realtime-mapping-context</type>
          <name>realtime-mapping-context</name>
          <context-binding-broker>
            <type xmlns:binding="urn:opendaylight:params:xml:ns:yang:controller:md:sal:binding">binding:binding-async-data-broker</type>
            <name>honeycomb-context-binding-data-broker</name>
          </context-binding-broker>
        </module>
      </modules>

      <services xmlns="urn:opendaylight:params:xml:ns:yang:controller:config">
        <service>
          <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:translate:api">prefix:honeycomb-reader-factory</type>
          <instance>
            <name>context-reader</name>
            <provider>/modules/module[type='context-reader'][name='context-reader']</provider>
          </instance>
        </service>
        <service>
          <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:data:api">prefix:data-tree</type>
          <instance>
            <name>inmemory-context-data-tree</name>
            <provider>/modules/module[type='inmemory-data-tree'][name='inmemory-context-data-tree']
            </provider>
          </instance>
          <instance>
            <name>inmemory-persisted-context-data-tree</name>
            <provider>/modules/module[type='persisting-data-tree-adapter'][name='inmemory-persisted-context-data-tree']
            </provider>
          </instance>
        </service>

        <service>
          <type xmlns:dom="urn:opendaylight:params:xml:ns:yang:controller:md:sal:dom">dom:dom-async-data-broker</type>
          <instance>
            <name>honeycomb-context-data-broker</name>
            <provider>/modules/module[type='honeycomb-context-dom-data-broker'][name='honeycomb-context-data-broker']</provider>
          </instance>
        </service>

        <service>
          <type xmlns:binding="urn:opendaylight:params:xml:ns:yang:controller:md:sal:binding">binding:binding-async-data-broker</type>
          <instance>
            <name>honeycomb-context-binding-data-broker</name>
            <provider>/modules/module[type='binding-forwarded-data-broker'][name='honeycomb-context-binding-data-broker']</provider>
          </instance>
        </service>

        <service>
          <type xmlns:prefix="urn:honeycomb:params:xml:ns:yang:translate:api">prefix:honeycomb-mapping-context</type>
          <instance>
            <name>realtime-mapping-context</name>
            <provider>/modules/module[type='realtime-mapping-context'][name='realtime-mapping-context']</provider>
          </instance>
        </service>
      </services>
    </data>
  </configuration>
</snapshot>
